<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Profile</title>
    <link rel="stylesheet" href="../../css/user.css" />
    <script src="../../js/config.js"></script>
    <script src="../../node_modules/htmx.org/dist/htmx.js"></script>
    <script src="../../js/adminCheck.js"></script>
  </head>
  <body>
    <h1>User Profile</h1>
    <div
      id="user-profile"
      hx-get="/user/profile"
      hx-trigger="load"
      hx-target="#user-profile"
    >
      <!-- profile should be loaded here-->
    </div>
    <div id="edit-profile" style="display: block">
      <h2>Edit Profile</h2>
      <form
        id="edit-profile-form"
        hx-put="/user/edit"
        hx-target="#user-profile"
        hx-swap="outerHTML"
      >
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" /><br /><br />
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" /><br /><br />
        <button type="submit">Update Profile</button>
      </form>
    </div>
    <script>
      document.body.addEventListener("htmx:configRequest", (event) => {
        const user = JSON.parse(localStorage.getItem("user"));
        if (user && user.accessToken) {
          event.detail.headers["Authorization"] = `Bearer ${user.accessToken}`;
          event.detail.headers["x-refresh-token"] = user.refreshToken;
        }
      });

      function toggleEditProfile() {
        const editProfile = document.getElementById("edit-profile");
        editProfile.style.display === "none" ? "block" : "none";
      }
    </script>
  </body>
</html>
